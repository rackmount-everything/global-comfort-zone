#Color Set up
NC='\033[0m' # No Color
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
RED='\033[0;31m'
BLUE='\033[0;34m'
PURPLE='\033[1;35m'

# Choose MODE=SUN for SunOS, choose MODE=SMART for SmartOS
BRAND="SMART"


# Get zpool status and last login
ZSTATUS=`zpool status zones | head -n2 | tail -n1 | cut -c9-`
if [[ `echo $ZSTATUS | cut -c1-6` -eq "ONLINE" ]]; then
    ZSTATUS=$GREEN$ZSTATUS$NC
else
    ZSTATUS=$RED$ZSTATUS$NC
fi
LASTLOG=`last root | head -n2 | tail -n1 | cut -c41-`


# 23 lines of ASCII art
if [ $BRAND = "SMART" ]; then
LOGO=$BLUE
l[1]='                              //////           '
l[2]='            /*          //////////////         '
l[3]='        //  //      ////////////////////       '
l[4]='     /////      *////////////////////////,     '
l[5]='   ///////*   /////////////////////////////    '
l[6]=' //////////    ////////////////////////        '
l[7]='////////////    /////////////////         ///  '
l[8]='/////////////    /////////////      ,//    /   '
l[9]='//////////////    /////////      ///////*      '
l[10]=' //////////////.    /////     ////////////     '
l[11]=' ////////////////    /     ////////////////    '
l[12]='  ////////////////,        /////////////////   '
l[13]='   /////////////////        /////////////////  '
l[14]='    ////////////////    ./    ///////////////. '
l[15]='     ////////////     /////.    ////////////// '
l[16]='      ////////      /////////    //////////////'
l[17]='   /    ///      /////////////    /////////////'
l[18]='  ///        ./////////////////    ////////////'
l[19]='        *///////////////////////.   ////////// '
l[20]='    /////////////////////////////   *///////   '
l[21]='     //////////////////////////      /////     '
l[22]='       ////////////////////      //  //        '
l[23]='         //////////////          //            '
elif [ $BRAND = "SUN" ]; then
LOGO=$YELLOW
l[1]='                       . ..                      '
l[2]='                            ...                  ' 
l[3]='         ......           .....                  '
l[4]='            .....    ..........                  '
l[5]='            .....   ..........           .       '
l[6]='           .......   .......    ....      .      '
l[7]='          .........   ......   ............      ' 
l[8]='          .................................      '
l[9]='  .....      .........   ................        '
l[10]='...........  .....          .......              '
l[11]='     ............             ....   ..          '
l[12]='.    ...........              ...........        '
l[13]='      ..........              ............    .  '
l[14]='             ....             ............    .  '
l[15]='           ........         .....    .........   '
l[16]='      ............................      ....     '
l[17]='    ............. ...................            '
l[18]='   .............   ......   .........            '
l[19]='    .      ...    ........   .......             '
l[20]='     .           .........    .....              '
l[21]='                .........     .....              '
l[22]='                ....            ......           '
l[23]='                ...                              '
fi

# Text to be plased next to the ASCII art
if [ $BRAND = "SMART" ]; then
t[1]="+---------------------------------------------------+"
t[2]='|   Welcome Back!                                   |'
t[3]="| $BLUE   _____                      __  ____  _____    $NC |"
t[4]="| $BLUE  / ___/____ ___  ____ ______/ /_/ __ \/ ___/    $NC |"
t[5]="| $BLUE  \__ \/ __ \`__ \/ __ \`/ ___/ __/ / / /\__ \     $NC |"
t[6]="| $BLUE ___/ / / / / / / /_/ / /  / /_/ /_/ /___/ /     $NC |"
t[7]="| $BLUE/____/_/ /_/ /_/\__,_/_/   \__/\____//____/      $NC |"
t[8]='+---------------------------------------------------+'
elif [ $BRAND = "SUN" ]; then
t[1]="+---------------------------------------------------+"
t[2]='|   Welcome Back!                                   |'
t[3]="| $PURPLE   _____             ____  _____    ______ ______$NC |"
t[4]="| $PURPLE  / ___/__  ______  / __ \/ ___/   / ____/<  <  /$NC |"
t[5]="| $PURPLE  \__ \/ / / / __ \/ / / /\__ \   /___ \  / // / $NC |"
t[6]="| $PURPLE ___/ / /_/ / / / / /_/ /___/ /  ____/ / / // /  $NC |"
t[7]="| $PURPLE/____/\__,_/_/ /_/\____//____/  /_____(_)_//_/   $NC |"
t[8]='+---------------------------------------------------+'
fi
t[9]="|Last login was ${LASTLOG}"
t[10]='+---------------------------------------------------+'
t[11]="|Your zpool is ${ZSTATUS}                               |"
t[12]="|`zpool status zones | head -n1`                                      |"
t[13]="|`zpool status zones | head -n2 | tail -n1`                                     |"
t[14]="|`zpool status zones | head -n3 | tail -n1`                             |"
t[15]="+---------------------------------------------------+"

# Print the text
if [[ `tput cols` -lt 102 ]]; then
        MODE="NARROW"
else
        MODE="WIDE"
fi
case $MODE in
WIDE)
        i=1
        for line in "${l[@]}"; do
                printf "$LOGO$line$NC${t[i]}\n"
                
                i=$(($i+1))
        done
        ;;
NARROW)
        i=1
        for line in "${l[@]}"; do
                printf "$LOGO$line$NC\n"

                i=$(($i+1))
        done
        for line in "${t[@]}"; do
                printf "$line\n"

                i=$(($i+1))
        done
        ;;
esac
        
# load regular .bashrc
if [ -f $HOME/.bashrc ]; then
        source $HOME/.bashrc
fi
